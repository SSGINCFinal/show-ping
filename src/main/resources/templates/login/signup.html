<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShowPing íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="/css/login/signup.css">
    <script src="/js/jwt.js"></script>
</head>
<body>
<div class="container">
    <div class="logo-area">
        <h1>ShowPing!</h1>
        <div class="logo">S</div>
    </div>
    <div class="signup-form">
        <h2>íšŒì›ê°€ì…</h2>

        <input type="text" placeholder="ì´ë¦„" id="name">

        <div class="input-group">
            <input type="email" placeholder="ì´ë©”ì¼" id="email">
            <button class="verify-btn">ì¸ì¦ ì½”ë“œ ë³´ë‚´ê¸°</button>
        </div>

        <div class="input-group" id="email-verify-section">
            <input type="text" placeholder="ì¸ì¦ ì½”ë“œ ì…ë ¥" id="email-code">
            <button class="verify-code-btn">í™•ì¸</button>
        </div>

        <form id="signup-form" onsubmit="return false;">
            <div class="input-group">
                <input type="text" placeholder="ì•„ì´ë””" id="memberId" name="memberId">
                <button class="button" onclick="checkDuplicate()">ì¤‘ë³µ í™•ì¸</button>
            </div>
        </form>

        <div class="input-group">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button type="button" class="toggle-password">ğŸ‘</button>
        </div>

        <div class="input-group">
            <input type="password" id="confirm-password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            <button type="button" class="toggle-password">ğŸ‘</button>
        </div>

        <div>
            <button type="button" class="check-password-btn">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</button>
        </div>

        <div class="input-group">
            <input type="text" placeholder="ì£¼ì†Œ" id="address">
            <button type="button" class="find-address-btn">ì£¼ì†Œ ê²€ìƒ‰</button>
        </div>

        <!-- ì „í™”ë²ˆí˜¸ ì…ë ¥ -->
        <div class="input-group">
            <input type="text" placeholder="ì „í™”ë²ˆí˜¸" id="phone">
        </div>

        <button type="submit" class="signup-btn">ê°€ì…í•˜ê¸°</button>
    </div>
</div>

<script>
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function () {
            const input = this.previousElementSibling;
            if (input.type === "password") {
                input.type = "text";
                this.textContent = "ğŸ”’";
            } else {
                input.type = "password";
                this.textContent = "ğŸ‘";
            }
        });
    });


    document.querySelector('.verify-code-btn').addEventListener('click', function () {
        const email = document.getElementById('email').value;
        const emailCode = document.getElementById('email-code').value;

        fetch(`/signup/verify-code?email=${encodeURIComponent(email)}&code=${encodeURIComponent(emailCode)}`, {
            method: 'POST'
        })
            .then(response => response.json())
            .then(isValid => {
                if (isValid) {
                    alert("ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ!");
                } else {
                    alert("ì¸ì¦ ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            })
            .catch(error => {
                console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                alert("ì¸ì¦ ì½”ë“œ í™•ì¸ ì‹¤íŒ¨");
            });
    });

    document.querySelector('.check-password-btn').addEventListener('click', function () {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (password === confirmPassword) {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.");
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
    });

    document.querySelector('.signup-btn').addEventListener('click', function () {
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const emailCode = document.getElementById('email-code').value.trim();
        const memberId = document.getElementById('memberId').value.trim();
        const password = document.getElementById('password').value.trim();
        const confirmPassword = document.getElementById('confirm-password').value.trim();
        const address = document.getElementById('address').value.trim();
        const phone = document.getElementById('phone').value.trim();

        if (!name) {
            alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        if (!email) {
            alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        if (!validateEmail(email)) {
            alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }
        if (!emailCode) {
            alert("ì´ë©”ì¼ ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        if (!memberId) {
            alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // ì¤‘ë³µ í™•ì¸ í›„ì— ì§„í–‰
        fetch(`/signup/check-id?memberId=${encodeURIComponent(memberId)}`)
            .then(response => response.json())
            .then(data => {
                // ë¹„ë°€ë²ˆí˜¸, ì£¼ì†Œ, ì „í™”ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§„í–‰
                if (!password) {
                    alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                if (!confirmPassword) {
                    alert("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                if (password !== confirmPassword) {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }
                if (!address) {
                    alert("ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                if (!phone) {
                    alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                if (!validatePhone(phone)) {
                    alert("ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: 010-1234-5678)");
                    return;
                }

                alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
            })
            .catch(error => {
                console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                alert("ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            });
    });

    // ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ì „ì†¡ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.querySelector('.verify-btn').addEventListener('click', function () {
        const email = document.getElementById('email').value.trim();

        if (!email) {
            alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        if (!validateEmail(email)) {
            alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        fetch('/signup/send-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: email })
        })
            .then(response => response.text())
            .then(data => {
                alert("ì¸ì¦ ì½”ë“œê°€ ì´ë©”ì¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                console.log("ì„œë²„ ì‘ë‹µ:", data);
            })
            .catch(error => {
                console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                alert("ì´ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨");
            });
    });

    // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }

    // ì „í™”ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
    function validatePhone(phone) {
        const phoneRegex = /^01[0-9]-\d{3,4}-\d{4}$/;
        return phoneRegex.test(phone);
    };

    // ì¤‘ë³µ í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
    function checkDuplicate() {
        const memberId = document.getElementById("memberId").value;

        // ì•„ì´ë””ê°€ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ Ajax ìš”ì²­
        if (memberId) {
            fetch(`/check-duplicate?id=${memberId}`)
                .then(response => {
                    if (response.ok) {
                        return response.text(); // ì„œë²„ì—ì„œ ì„±ê³µì ì¸ ì‘ë‹µì„ ë°›ìœ¼ë©´ ë©”ì‹œì§€ ë°˜í™˜
                    } else {
                        throw new Error('ì¤‘ë³µëœ ì•„ì´ë””ì…ë‹ˆë‹¤.'); // ì¤‘ë³µëœ ê²½ìš° ì˜¤ë¥˜ ë©”ì‹œì§€
                    }
                })
                .then(message => {
                    alert("ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤."); // ì¤‘ë³µë˜ì§€ ì•Šì€ IDì¼ ê²½ìš°
                })
                .catch(error => {
                    alert(error.message); // ì¤‘ë³µëœ IDì¼ ê²½ìš°
                });
        } else {
            alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        }
    }
</script>

<style>
    .input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }
    .input-group input {
        flex: 1;
    }
    .hidden {
        display: none;
    }
</style>

</body>
</html>