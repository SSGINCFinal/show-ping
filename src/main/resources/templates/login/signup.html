<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShowPing 회원가입</title>
    <link rel="stylesheet" href="/css/login/signup.css">
    <script src="/js/jwt.js"></script>
</head>
<body>
<div class="container">
    <div class="logo-area">
        <h1>ShowPing!</h1>
        <div class="logo">S</div>
    </div>
    <div class="signup-form">
        <h2>회원가입</h2>

        <!-- 이름 입력 -->
        <input type="text" placeholder="이름">

        <!-- 이메일 인증 -->
        <div class="input-group">
            <input type="email" placeholder="이메일" id="email">
            <button class="verify-btn">인증 코드 보내기</button>
        </div>

        <!-- 이메일 인증 코드 입력 -->
        <div class="input-group" id="email-verify-section">
            <input type="text" placeholder="인증 코드 입력" id="email-code">
            <button class="verify-code-btn">확인</button>
        </div>

        <!-- 아이디 입력 & 중복 확인 -->
        <div class="input-group">
            <input type="text" placeholder="아이디">
            <button class="check-id-btn">중복 확인</button>
        </div>

        <!-- 비밀번호 입력 -->
        <div class="input-group">
            <input type="password" id="password" placeholder="비밀번호">
            <button type="button" class="toggle-password">👁</button>
        </div>

        <!-- 비밀번호 확인 -->
        <div class="input-group">
            <input type="password" id="confirm-password" placeholder="비밀번호 확인">
            <button type="button" class="toggle-password">👁</button>
        </div>

        <!-- 비밀번호 확인 버튼 -->
        <div>
            <button type="button" class="check-password-btn">비밀번호 확인</button>
        </div>

        <!-- 주소 입력 & 검색 -->
        <div class="input-group">
            <input type="text" placeholder="주소" id="address">
            <button type="button" class="find-address-btn">주소 검색</button>
        </div>

        <button type="submit">가입하기</button>
    </div>
</div>

<script>
    // 비밀번호 보이기/숨기기 기능
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function () {
            const input = this.previousElementSibling;
            if (input.type === "password") {
                input.type = "text";
                this.textContent = "🔒";
            } else {
                input.type = "password";
                this.textContent = "👁";
            }
        });
    });

    document.querySelector('.verify-btn').addEventListener('click', function () {
        const email = document.getElementById('email').value;

        if (!validateEmail(email)) {
            alert("올바른 이메일 주소를 입력하세요.");
            return;
        }
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        fetch('/signup/send-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: email })
        })
            .then(response => response.text())
            .then(data => {
                alert("인증 코드가 이메일로 전송되었습니다.");
                console.log("서버 응답:", data);
            })
            .catch(error => {
                console.error("오류 발생:", error);
                alert("이메일 전송 실패");
            });
    });

    document.querySelector('.verify-code-btn').addEventListener('click', function () {
        const email = document.getElementById('email').value;
        const emailCode = document.getElementById('email-code').value;

        fetch(`/signup/verify-code?email=${encodeURIComponent(email)}&code=${encodeURIComponent(emailCode)}`, {
            method: 'POST'
        })
            .then(response => response.json())
            .then(isValid => {
                if (isValid) {
                    alert("이메일 인증 완료!");
                } else {
                    alert("인증 코드가 일치하지 않습니다.");
                }
            })
            .catch(error => {
                console.error("오류 발생:", error);
                alert("인증 코드 확인 실패");
            });
    });

    // 비밀번호 확인
    document.querySelector('.check-password-btn').addEventListener('click', function () {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (password === confirmPassword) {
            alert("비밀번호가 일치합니다.");
        } else {
            alert("비밀번호가 일치하지 않습니다.");
        }
    });
    fetch('/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ memberId: 'test123', password: 'password123' })
    })
        .then(response => response.json())
        .then(data => {
            if (data.accessToken) {
                localStorage.setItem('accessToken', data.accessToken);
                localStorage.setItem('refreshToken', data.refreshToken);
                console.log('로그인 성공:', data);
            } else {
                console.log('로그인 실패:', data.error);
            }
        });
</script>

<style>
    .input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }
    .input-group input {
        flex: 1;
    }
    .hidden {
        display: none;
    }
</style>

</body>
</html>
